---
title: "Project"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```




## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

```{r joinedlistings, echo=FALSE}
listings <- read_csv("listings (3).csv")
#View(listings)

listings2 <- read_csv("listings (3).csv.gz")
#View(listings2)
 
listings2<-listings2[,c(1,52,53,54,55,56,57,66,67)]

neighborhood <- read_csv("neighbourhoods (3).csv")
#View(neighborhood)

joinedlistings1 <- left_join(listings, neighborhood, by = "neighbourhood")
joinedlistings <-left_join(joinedlistings1, listings2, by ="id") 
#View(joinedlistings)

inputPanel(
  selectInput("n_breaks", label = "Number of bins:",
              choices = c(10, 20, 35, 50), selected = 20),
  
  sliderInput("bw_adjust", label = "Bandwidth adjustment:",
              min = 0.2, max = 2, value = 1, step = 0.2)
)

renderPlot({
  hist(joinedlistings$price, probability = TRUE, 
       breaks = as.numeric(input$n_breaks),
       xlab = "Duration (minutes)", 
       main = "Geyser eruption duration")
  
  dens <- density(faithful$vfgbhudn, adjust = input$bw_adjust)
  lines(dens, col = "blue")
})
```
When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars, eval = FALSE}

joinedlistings%>%
  filter(!is.na(`median home price`) & !is.na(availability_365))%>%
  group_by(neighbourhood)%>%
    filter(n()>20)%>%
  summarize(median_home_price = mean(`median home price`),
            mean_nights_rented = mean(availability_365))%>%
  ggplot(mapping=aes(x= median_home_price, y = mean_nights_rented, color = neighbourhood))+
  geom_point()

joinedlistings%>%
  filter(!is.na(price) & !is.na(bathrooms))%>%
  ggplot(mapping=aes(x= as_factor(bathrooms), y = price))+
  geom_boxplot()

joinedlistings%>%
  filter(!is.na(price) & !is.na(property_type))%>%
  filter(count(neighbourhood) > 100)
  ungroup
  ungroup%>%
  ggplot(mapping=aes(x= as_factor(property_type), y = price))+
  geom_boxplot()

joinedlistings%>%
  filter(!is.na(price) & !is.na(property_type))%>%
  group_by(property_type)%>%
  summarize(mean_price = mean(price),
            count = n())%>%
  filter(count > 10)%>%
  ungroup%>%
  ggplot(mapping=aes(x= as_factor(property_type), y = mean_price))+
  geom_boxplot()

joinedlistings%>%
  filter(!is.na(`median home price`) & !is.na(price))%>%
  group_by(neighbourhood)%>%
  filter(n()>20)%>%
  summarize(median_home_price = mean(`median home price`),
            mean_price = mean(price))%>%
  ggplot(mapping=aes(x= median_home_price, y = mean_price, color = neighbourhood))+
  geom_point()

  joinedlistings%>%
      filter(!is.na(price) & !is.na(availability_365))%>%
    ggplot(mapping=aes(x= price, y = availability_365))+
    geom_point()+
    facet_wrap(~neighbourhood)
  
  View(joinedlistings%>%
    filter(str_detect(joinedlistings$name, "Cup")))
  
joinedlistings %>%
  mutate(has_phrase=str_detect(tolower(joinedlistings$name), "sunny"))%>%
  filter(!is.na(has_phrase))%>%
 group_by(has_phrase, neighbourhood) %>%
 summarise(mean_price_per_neighborhood = mean(price))%>%
  ggplot(mapping = aes(x = neighbourhood, y = mean_price_per_neighborhood, color = has_phrase))+
  geom_point()

joinedlistings %>%
  mutate(has_phrase=str_detect(tolower(joinedlistings$name), "cup"))%>%
  filter(!is.na(has_phrase))%>%
  ggplot(mapping = aes(x = neighbourhood, y = price, color = has_phrase))+
  geom_boxplot()

joinedlistings %>%
  mutate(has_phrase=str_detect(tolower(joinedlistings$name), "cup"))%>%
  filter(!is.na(has_phrase))%>%
  ggplot(mapping = aes(x = has_phrase, y = price))+
  geom_violin()



joinedlistings %>%
  mutate(has_phrase=str_detect(tolower(joinedlistings$name), "sunny"))%>%
  filter(!is.na(has_phrase))%>%
  ggplot(mapping = aes(x = neighbourhood, fill = has_phrase))+
  geom_bar(aes(y = (..count..)/sum(..count..)))
  geom_bar(stat = "count", position = "dodge")

  
joinedlistings%>%
    group_by(neighbourhood)%>%
    mutate(has_phrase=str_detect(tolower(joinedlistings$name), "sunny"))%>%
    ggplot(mapping = aes(x = neighbourhood, y = price, color = has_phrase))+
    geom_point()
  
  joinedlistings%>%
    filter(price>500)%>%
    group_by(neighbourhood)%>%
    filter(n()>5)%>%
    ##summarize(mean_price = mean(price))%>%
    ungroup%>%
    ggplot(mapping = aes(x=neighbourhood), color = fct_reorder(neighbourhood, `median home price`))+
    geom_bar(aes(fill = "identity"))+
    labs(color = "")
  
  
  
    joinedlistings%>%
    filter(price>500)%>%
      ggplot(mapping = aes(x=neighbourhood, fill = neighbourhood))+
    geom_bar()+
      labs(x = " ")+
      scale_x_discrete(labels = c("","","","","","","","","","","","","","",""))
      
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
